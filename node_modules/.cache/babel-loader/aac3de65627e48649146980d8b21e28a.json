{"ast":null,"code":"import axios from '../utils/axiosInstance';\nimport history from '../utils/history';\nimport setAuthToken from '../utils/setAuthToken';\nconst LOGIN_API = '/users/signin';\nconst OTP_VERIFICATION_API = '/user/otpVer';\n\n// Action types\nconst START_LOGIN_USER = 'START_LOGIN_USER';\nconst START_OTP_VERIFICATION = 'START_OTP_VERIFICATION';\nconst LOGOUT_USER = 'LOGOUT_USER';\n\n// Action creators\nconst loginUser = userData => ({\n  type: START_LOGIN_USER,\n  payload: userData\n});\nconst logoutUser = () => ({\n  type: LOGOUT_USER\n});\n\n// Thunk actions\nexport const startLoginUser = (payload, history) => async dispatch => {\n  try {\n    const response = await axios.post(OTP_VERIFICATION_API, payload);\n    const {\n      data\n    } = response;\n    const token = data.data.token;\n    sessionStorage.setItem('token', token);\n\n    // Extract necessary data from the response\n    if (token) {\n      sessionStorage.setItem('isAuthenticated', true);\n      const authDetails = {\n        isAuthenticated: true,\n        user: {\n          ...data.data.user_info\n        },\n        bank: {\n          ...data.data.bank_info\n        },\n        has_pin: data.data.has_pin,\n        image: data.data.image\n      };\n      setAuthToken(token);\n      dispatch(loginUser(authDetails));\n      sessionStorage.setItem('user', JSON.stringify(authDetails));\n      // Use history.replace instead of history.push to replace the current entry\n      history.replace('/overview');\n      window.location.reload();\n    }\n\n    // Dispatch action to update the store with code\n  } catch (error) {\n    // Handle login error\n    console.error('Login error:', error);\n  }\n};\nexport const startLogout = () => dispatch => {\n  dispatch({\n    type: 'SET_LOADING',\n    payload: {\n      loading: false,\n      message: undefined\n    }\n  });\n  sessionStorage.clear('user');\n  sessionStorage.clear('token');\n  sessionStorage.clear('balance');\n  history.push('/');\n  dispatch(logoutUser());\n};","map":{"version":3,"names":["axios","history","setAuthToken","LOGIN_API","OTP_VERIFICATION_API","START_LOGIN_USER","START_OTP_VERIFICATION","LOGOUT_USER","loginUser","userData","type","payload","logoutUser","startLoginUser","dispatch","response","post","data","token","sessionStorage","setItem","authDetails","isAuthenticated","user","user_info","bank","bank_info","has_pin","image","JSON","stringify","replace","window","location","reload","error","console","startLogout","loading","message","undefined","clear","push"],"sources":["C:/Users/USER/Documents/flexiMoney-web-app/src/actions/auth2.js"],"sourcesContent":["import axios from '../utils/axiosInstance';\r\nimport history from '../utils/history';\r\nimport setAuthToken from '../utils/setAuthToken';\r\n\r\n\r\n\r\nconst LOGIN_API = '/users/signin';\r\nconst OTP_VERIFICATION_API = '/user/otpVer';\r\n\r\n// Action types\r\nconst START_LOGIN_USER = 'START_LOGIN_USER';\r\nconst START_OTP_VERIFICATION = 'START_OTP_VERIFICATION';\r\nconst LOGOUT_USER = 'LOGOUT_USER';\r\n\r\n// Action creators\r\nconst loginUser = (userData) => ({\r\n  type: START_LOGIN_USER,\r\n  payload: userData,\r\n});\r\n\r\n\r\n\r\nconst logoutUser = () => ({\r\n  type: LOGOUT_USER,\r\n});\r\n\r\n// Thunk actions\r\nexport const startLoginUser = (payload, history) => async (dispatch) => {\r\n  try {\r\n    const response = await axios.post(OTP_VERIFICATION_API, payload);\r\n    const { data } = response;\r\n    const token = data.data.token;\r\n    sessionStorage.setItem('token', token);\r\n\r\n\r\n    // Extract necessary data from the response\r\n    if (token) {\r\n      sessionStorage.setItem('isAuthenticated', true);\r\n      const authDetails = {\r\n        isAuthenticated: true,\r\n        user: {\r\n          ...data.data.user_info\r\n        },\r\n        bank: {\r\n          ...data.data.bank_info\r\n        },\r\n        has_pin: data.data.has_pin,\r\n        image: data.data.image,\r\n\r\n\r\n      };\r\n      setAuthToken(token);\r\n      dispatch(loginUser(authDetails));\r\n      sessionStorage.setItem('user', JSON.stringify(authDetails));\r\n      // Use history.replace instead of history.push to replace the current entry\r\n      history.replace('/overview');\r\n      window.location.reload();\r\n\r\n    }\r\n\r\n\r\n\r\n    // Dispatch action to update the store with code\r\n\r\n  } catch (error) {\r\n    // Handle login error\r\n    console.error('Login error:', error);\r\n  }\r\n};\r\n\r\n\r\n\r\nexport const startLogout = () => (dispatch) => {\r\n    dispatch({\r\n        type: 'SET_LOADING',\r\n        payload: {\r\n            loading: false,\r\n            message: undefined,\r\n        },\r\n    });\r\n\r\n    sessionStorage.clear('user');\r\n    sessionStorage.clear('token');\r\n    sessionStorage.clear('balance');\r\n    history.push('/');\r\n    dispatch(logoutUser());\r\n};\r\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,wBAAwB;AAC1C,OAAOC,OAAO,MAAM,kBAAkB;AACtC,OAAOC,YAAY,MAAM,uBAAuB;AAIhD,MAAMC,SAAS,GAAG,eAAe;AACjC,MAAMC,oBAAoB,GAAG,cAAc;;AAE3C;AACA,MAAMC,gBAAgB,GAAG,kBAAkB;AAC3C,MAAMC,sBAAsB,GAAG,wBAAwB;AACvD,MAAMC,WAAW,GAAG,aAAa;;AAEjC;AACA,MAAMC,SAAS,GAAIC,QAAQ,KAAM;EAC/BC,IAAI,EAAEL,gBAAgB;EACtBM,OAAO,EAAEF;AACX,CAAC,CAAC;AAIF,MAAMG,UAAU,GAAGA,CAAA,MAAO;EACxBF,IAAI,EAAEH;AACR,CAAC,CAAC;;AAEF;AACA,OAAO,MAAMM,cAAc,GAAGA,CAACF,OAAO,EAAEV,OAAO,KAAK,MAAOa,QAAQ,IAAK;EACtE,IAAI;IACF,MAAMC,QAAQ,GAAG,MAAMf,KAAK,CAACgB,IAAI,CAACZ,oBAAoB,EAAEO,OAAO,CAAC;IAChE,MAAM;MAAEM;IAAK,CAAC,GAAGF,QAAQ;IACzB,MAAMG,KAAK,GAAGD,IAAI,CAACA,IAAI,CAACC,KAAK;IAC7BC,cAAc,CAACC,OAAO,CAAC,OAAO,EAAEF,KAAK,CAAC;;IAGtC;IACA,IAAIA,KAAK,EAAE;MACTC,cAAc,CAACC,OAAO,CAAC,iBAAiB,EAAE,IAAI,CAAC;MAC/C,MAAMC,WAAW,GAAG;QAClBC,eAAe,EAAE,IAAI;QACrBC,IAAI,EAAE;UACJ,GAAGN,IAAI,CAACA,IAAI,CAACO;QACf,CAAC;QACDC,IAAI,EAAE;UACJ,GAAGR,IAAI,CAACA,IAAI,CAACS;QACf,CAAC;QACDC,OAAO,EAAEV,IAAI,CAACA,IAAI,CAACU,OAAO;QAC1BC,KAAK,EAAEX,IAAI,CAACA,IAAI,CAACW;MAGnB,CAAC;MACD1B,YAAY,CAACgB,KAAK,CAAC;MACnBJ,QAAQ,CAACN,SAAS,CAACa,WAAW,CAAC,CAAC;MAChCF,cAAc,CAACC,OAAO,CAAC,MAAM,EAAES,IAAI,CAACC,SAAS,CAACT,WAAW,CAAC,CAAC;MAC3D;MACApB,OAAO,CAAC8B,OAAO,CAAC,WAAW,CAAC;MAC5BC,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC,CAAC;IAE1B;;IAIA;EAEF,CAAC,CAAC,OAAOC,KAAK,EAAE;IACd;IACAC,OAAO,CAACD,KAAK,CAAC,cAAc,EAAEA,KAAK,CAAC;EACtC;AACF,CAAC;AAID,OAAO,MAAME,WAAW,GAAGA,CAAA,KAAOvB,QAAQ,IAAK;EAC3CA,QAAQ,CAAC;IACLJ,IAAI,EAAE,aAAa;IACnBC,OAAO,EAAE;MACL2B,OAAO,EAAE,KAAK;MACdC,OAAO,EAAEC;IACb;EACJ,CAAC,CAAC;EAEFrB,cAAc,CAACsB,KAAK,CAAC,MAAM,CAAC;EAC5BtB,cAAc,CAACsB,KAAK,CAAC,OAAO,CAAC;EAC7BtB,cAAc,CAACsB,KAAK,CAAC,SAAS,CAAC;EAC/BxC,OAAO,CAACyC,IAAI,CAAC,GAAG,CAAC;EACjB5B,QAAQ,CAACF,UAAU,CAAC,CAAC,CAAC;AAC1B,CAAC"},"metadata":{},"sourceType":"module"}
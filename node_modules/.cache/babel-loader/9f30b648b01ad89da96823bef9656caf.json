{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\USER\\\\Documents\\\\flexiMoney-web-app\\\\src\\\\features\\\\services\\\\cable\\\\index.js\";\nimport React, { useState, useReducer } from 'react';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport axios from '../../../utils/axiosInstance';\nimport RechargeCableReducer, { initialFormState } from './cable-reducer';\nimport { setCurrentPage } from '../../../actions/page';\nimport { VEND_STARTIMES, VEND_MULTICHOICE } from '../../../utils/constants';\nimport RechargeCableForm from './RechargeCableForm';\nimport RechargeCableStatus from './RechargeCableStatus';\nimport RechargeCableSummary from './RechargeCableSummary';\nimport FailedTransaction from '../../../components/common/FailedTransaction';\nimport { useCustomToast } from '../../../components/toast/useCustomToast';\nexport const RechargeCable = ({\n  service,\n  hasSetPin\n}) => {\n  const TRANSACTION_COST = 0;\n  let renderedComponent;\n  const [componentToRender, setComponentToRender] = useState('form');\n  const [RechargeCableFormState, dispatch] = useReducer(RechargeCableReducer, initialFormState);\n  const [successData, setSuccessData] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const showToast = useToasts();\n  const [failedErrorMessage, setFailedErrorMessage] = useState('');\n  const getTransactionDate = date => {\n    const dateString = date.toLocaleDateString();\n    return dateString.slice(0, 24);\n  };\n  const handleOnSubmit = () => {\n    setLoading(true);\n    let providerApi;\n    let payload;\n    const {\n      smartCardNumber,\n      amount,\n      selectedPlanCode,\n      cycle,\n      phone,\n      transaction_pin\n    } = RechargeCableFormState;\n    if (service === 'dstv' || service === 'gotv') {\n      providerApi = VEND_MULTICHOICE;\n      payload = {\n        smartcard: smartCardNumber,\n        amount,\n        phone,\n        code: selectedPlanCode,\n        type: service,\n        validity: cycle,\n        transaction_pin: transaction_pin\n      };\n    } else if (service === 'startimes') {\n      providerApi = VEND_STARTIMES;\n      payload = {\n        smartcard: smartCardNumber,\n        amount,\n        phone,\n        code: selectedPlanCode,\n        type: service,\n        validity: cycle,\n        transaction_pin: transaction_pin\n      };\n    }\n    (async function vendCable() {\n      try {\n        const res = await axios.post(providerApi, payload);\n        const successData = res.data.data;\n        const message = res.data.data.message;\n        const date = new Date();\n        const transactionDate = getTransactionDate(date);\n        setLoading(false);\n        setSuccessData({\n          ...successData,\n          date: transactionDate\n        });\n        addToast(message, {\n          appearance: 'success',\n          autoDismiss: true\n        });\n        setComponentToRender('success');\n      } catch (e) {\n        setLoading(false);\n        addToast(e.response.data.data, {\n          appearance: 'error',\n          autoDismiss: true\n        });\n        setFailedErrorMessage(e.response.data.message || undefined);\n        setComponentToRender('failed');\n      }\n    })();\n  };\n  switch (componentToRender) {\n    case 'form':\n      renderedComponent = /*#__PURE__*/React.createElement(RechargeCableForm, {\n        service: service,\n        RechargeCableFormState: RechargeCableFormState,\n        setFormState: dispatch,\n        setComponentToRender: setComponentToRender,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 94,\n          columnNumber: 17\n        }\n      });\n      break;\n    case 'summary':\n      renderedComponent = /*#__PURE__*/React.createElement(RechargeCableSummary, {\n        RechargeCableFormState: RechargeCableFormState,\n        loading: loading,\n        handleOnSubmit: handleOnSubmit,\n        transactionCost: TRANSACTION_COST,\n        service: service,\n        dispatch: dispatch,\n        hasSetPin: hasSetPin,\n        setComponentToRender: setComponentToRender,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 104,\n          columnNumber: 17\n        }\n      });\n      break;\n    case 'success':\n      renderedComponent = /*#__PURE__*/React.createElement(RechargeCableStatus, {\n        successData: successData,\n        formState: RechargeCableFormState,\n        setComponentToRender: setComponentToRender,\n        transactionCost: TRANSACTION_COST,\n        service: service,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 17\n        }\n      });\n      break;\n    case 'failed':\n      renderedComponent = /*#__PURE__*/React.createElement(FailedTransaction, {\n        message: failedErrorMessage,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 17\n        }\n      });\n      break;\n    default:\n      renderedComponent = null;\n  }\n  return /*#__PURE__*/React.createElement(React.Fragment, null, renderedComponent);\n};\nconst mapStateToProps = state => {\n  return {\n    service: state.modal.service,\n    hasSetPin: state.auth.user.transaction_pin\n  };\n};\nconst mapDispatchToProps = dispatch => {\n  return {\n    changeCurrentPage: payload => dispatch(setCurrentPage(payload))\n  };\n};\nRechargeCable.propTypes = {\n  changeCurrentPage: PropTypes.func.isRequired\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(RechargeCable);","map":{"version":3,"names":["React","useState","useReducer","PropTypes","connect","axios","RechargeCableReducer","initialFormState","setCurrentPage","VEND_STARTIMES","VEND_MULTICHOICE","RechargeCableForm","RechargeCableStatus","RechargeCableSummary","FailedTransaction","useCustomToast","RechargeCable","service","hasSetPin","TRANSACTION_COST","renderedComponent","componentToRender","setComponentToRender","RechargeCableFormState","dispatch","successData","setSuccessData","loading","setLoading","showToast","useToasts","failedErrorMessage","setFailedErrorMessage","getTransactionDate","date","dateString","toLocaleDateString","slice","handleOnSubmit","providerApi","payload","smartCardNumber","amount","selectedPlanCode","cycle","phone","transaction_pin","smartcard","code","type","validity","vendCable","res","post","data","message","Date","transactionDate","addToast","appearance","autoDismiss","e","response","undefined","createElement","setFormState","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","transactionCost","formState","Fragment","mapStateToProps","state","modal","auth","user","mapDispatchToProps","changeCurrentPage","propTypes","func","isRequired"],"sources":["C:/Users/USER/Documents/flexiMoney-web-app/src/features/services/cable/index.js"],"sourcesContent":["import React, { useState, useReducer } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { connect } from 'react-redux';\r\nimport axios from '../../../utils/axiosInstance';\r\nimport RechargeCableReducer, { initialFormState } from './cable-reducer';\r\nimport { setCurrentPage } from '../../../actions/page';\r\nimport { VEND_STARTIMES, VEND_MULTICHOICE } from '../../../utils/constants';\r\nimport RechargeCableForm from './RechargeCableForm';\r\nimport RechargeCableStatus from './RechargeCableStatus';\r\nimport RechargeCableSummary from './RechargeCableSummary';\r\nimport FailedTransaction from '../../../components/common/FailedTransaction';\r\nimport { useCustomToast } from '../../../components/toast/useCustomToast';\r\n\r\nexport const RechargeCable = ({ service, hasSetPin }) => {\r\n    const TRANSACTION_COST = 0;\r\n    let renderedComponent;\r\n    const [componentToRender, setComponentToRender] = useState('form');\r\n    const [RechargeCableFormState, dispatch] = useReducer(\r\n        RechargeCableReducer,\r\n        initialFormState\r\n    );\r\n    const [successData, setSuccessData] = useState(null);\r\n    const [loading, setLoading] = useState(false);\r\n    const showToast= useToasts();\r\n    const [failedErrorMessage, setFailedErrorMessage] = useState('');\r\n\r\n    const getTransactionDate = (date) => {\r\n        const dateString = date.toLocaleDateString();\r\n        return dateString.slice(0, 24);\r\n    };\r\n\r\n    const handleOnSubmit = () => {\r\n        setLoading(true);\r\n\r\n        let providerApi;\r\n        let payload;\r\n        const { smartCardNumber, amount, selectedPlanCode, cycle, phone, transaction_pin } =\r\n            RechargeCableFormState;\r\n\r\n        if (service === 'dstv' || service === 'gotv') {\r\n            providerApi = VEND_MULTICHOICE;\r\n            payload = {\r\n                smartcard: smartCardNumber,\r\n                amount,\r\n                phone,\r\n                code: selectedPlanCode,\r\n                type: service,\r\n                validity: cycle,\r\n                transaction_pin:transaction_pin,\r\n            };\r\n        } else if (service === 'startimes') {\r\n            providerApi = VEND_STARTIMES;\r\n            payload = {\r\n                smartcard: smartCardNumber,\r\n                amount,\r\n                phone,\r\n                code: selectedPlanCode,\r\n                type: service,\r\n                validity: cycle,\r\n                transaction_pin:transaction_pin,\r\n            };\r\n        }\r\n\r\n        (async function vendCable() {\r\n            try {\r\n                const res = await axios.post(providerApi, payload);\r\n                const successData = res.data.data;\r\n                const message = res.data.data.message;\r\n                const date = new Date();\r\n                const transactionDate = getTransactionDate(date);\r\n\r\n                setLoading(false);\r\n                setSuccessData({ ...successData, date: transactionDate });\r\n                addToast(message, {\r\n                    appearance: 'success',\r\n                    autoDismiss: true,\r\n                });\r\n                setComponentToRender('success');\r\n            } catch (e) {\r\n                setLoading(false);\r\n                addToast(e.response.data.data, {\r\n                    appearance: 'error',\r\n                    autoDismiss: true,\r\n                });\r\n                setFailedErrorMessage(e.response.data.message || undefined);\r\n                setComponentToRender('failed');\r\n            }\r\n        })();\r\n    };\r\n\r\n    switch (componentToRender) {\r\n        case 'form':\r\n            renderedComponent = (\r\n                <RechargeCableForm\r\n                    service={service}\r\n                    RechargeCableFormState={RechargeCableFormState}\r\n                    setFormState={dispatch}\r\n                    setComponentToRender={setComponentToRender}\r\n                />\r\n            );\r\n            break;\r\n        case 'summary':\r\n            renderedComponent = (\r\n                <RechargeCableSummary\r\n                    RechargeCableFormState={RechargeCableFormState}\r\n                    loading={loading}\r\n                    handleOnSubmit={handleOnSubmit}\r\n                    transactionCost={TRANSACTION_COST}\r\n                    service={service}\r\n                    dispatch={dispatch}\r\n                    hasSetPin={hasSetPin}\r\n                    setComponentToRender={setComponentToRender}\r\n                />\r\n            );\r\n            break;\r\n        case 'success':\r\n            renderedComponent = (\r\n                <RechargeCableStatus\r\n                    successData={successData}\r\n                    formState={RechargeCableFormState}\r\n                    setComponentToRender={setComponentToRender}\r\n                    transactionCost={TRANSACTION_COST}\r\n                    service={service}\r\n                />\r\n            );\r\n            break;\r\n        case 'failed':\r\n            renderedComponent = (\r\n                <FailedTransaction message={failedErrorMessage} />\r\n            );\r\n            break;\r\n        default:\r\n            renderedComponent = null;\r\n    }\r\n\r\n    return <>{renderedComponent}</>;\r\n};\r\n\r\nconst mapStateToProps = (state) => {\r\n    return {\r\n        service: state.modal.service,\r\n        hasSetPin: state.auth.user.transaction_pin,\r\n    };\r\n};\r\n\r\nconst mapDispatchToProps = (dispatch) => {\r\n    return {\r\n        changeCurrentPage: (payload) => dispatch(setCurrentPage(payload)),\r\n    };\r\n};\r\n\r\nRechargeCable.propTypes = {\r\n    changeCurrentPage: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(RechargeCable);\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import axios from 'axios';\nimport { LOGIN_API } from '../utils/constants';\nimport setAuthToken from '../utils/setAuthToken';\n// import setAxiosDefaults from '../utils/setAxiosDefaults';\nimport isEmpty from '../validation/isEmpty';\nimport history from '../utils/history';\nimport { setWalletBalance } from './wallet';\nconst loginUser = ({\n  user,\n  isAuthenticated,\n  walletBalance,\n  commissionBalance,\n  transactionSettings,\n  virtualAccountNumber,\n  virtualAccountBank\n}) => {\n  return {\n    type: 'START_LOGIN_USER',\n    payload: {\n      isAuthenticated,\n      user,\n      walletBalance,\n      commissionBalance,\n      transactionSettings,\n      virtualAccountNumber,\n      virtualAccountBank\n    }\n  };\n};\nexport const startLoginUser = payload => dispatch => {\n  return axios.post(LOGIN_API, payload).then(res => {\n    var _res$data, _res$data2, _res$data3, _res$data4, _res$data5, _res$data6, _res$data7, _res$data8, _res$data9;\n    const user = res === null || res === void 0 ? void 0 : (_res$data = res.data) === null || _res$data === void 0 ? void 0 : _res$data.data.user;\n    const token = res === null || res === void 0 ? void 0 : (_res$data2 = res.data) === null || _res$data2 === void 0 ? void 0 : _res$data2.data.token;\n    const walletBalance = res === null || res === void 0 ? void 0 : (_res$data3 = res.data) === null || _res$data3 === void 0 ? void 0 : _res$data3.data.wallet.current_bal;\n    const commissionBalance = res === null || res === void 0 ? void 0 : (_res$data4 = res.data) === null || _res$data4 === void 0 ? void 0 : _res$data4.data.commission.current_commission;\n    const transactionSettings = res === null || res === void 0 ? void 0 : (_res$data5 = res.data) === null || _res$data5 === void 0 ? void 0 : _res$data5.data.settings;\n    const agentClassification = res === null || res === void 0 ? void 0 : (_res$data6 = res.data) === null || _res$data6 === void 0 ? void 0 : _res$data6.data.class;\n    const agent = res === null || res === void 0 ? void 0 : (_res$data7 = res.data) === null || _res$data7 === void 0 ? void 0 : _res$data7.data.agent;\n    const virtualAccountNumber = agent === null || agent === void 0 ? void 0 : agent.virtual_account_number;\n    const virtualAccountBank = agent === null || agent === void 0 ? void 0 : agent.virtual_account_bank;\n\n    // Extract virtual_account_number and virtual_account_bank from the agent object\n    // const { virtual_account_number: virtualAccountNumber, virtual_account_bank: virtualAccountBank } = agent;\n\n    const proprietor = res === null || res === void 0 ? void 0 : (_res$data8 = res.data) === null || _res$data8 === void 0 ? void 0 : _res$data8.data.user.proprietor;\n    const hasSetPin = res === null || res === void 0 ? void 0 : (_res$data9 = res.data) === null || _res$data9 === void 0 ? void 0 : _res$data9.data.has_set_pin;\n    const {\n      id,\n      username,\n      phone,\n      email,\n      is_default\n    } = user;\n    const {\n      first_name: firstName,\n      last_name: lastName,\n      user_id: userId,\n      business_name: businessName,\n      wallet_no: walletNo,\n      uuid,\n      gender,\n      business_address,\n      date_of_birth,\n      business_phone,\n      account_name,\n      account_number,\n      bank_id,\n      state_id,\n      local_government_id,\n      business_type,\n      bvn,\n      agent_code\n    } = agent;\n    if (!isEmpty(token)) {\n      const authDetails = {\n        isAuthenticated: true,\n        user: {\n          account_name,\n          account_number,\n          bank_id,\n          state_id,\n          local_government_id,\n          business_type,\n          agent_code,\n          id,\n          username,\n          phone,\n          email,\n          type: proprietor ? 'sub' : 'main',\n          uuid,\n          is_default,\n          business_address,\n          business_phone,\n          bvn,\n          firstName,\n          lastName,\n          virtualAccountNumber: virtualAccountNumber,\n          virtualAccountBank: virtualAccountBank,\n          agentClassification,\n          userId,\n          date_of_birth,\n          gender,\n          businessName,\n          walletNo,\n          hasSetPin\n        },\n        walletBalance,\n        transactionSettings\n      };\n      setAuthToken(token);\n      dispatch(loginUser(authDetails));\n      dispatch(setWalletBalance(walletBalance));\n      sessionStorage.setItem('user', JSON.stringify(authDetails));\n      sessionStorage.setItem('token', token);\n      sessionStorage.setItem('balance', walletBalance);\n    }\n  }).catch(err => {\n    if (err.response && err.response.status === 401) {\n      dispatch({\n        type: 'SET_LOADING',\n        payload: {\n          loading: false,\n          message: err.response.data.message\n        }\n      });\n    } else {\n      setTimeout(() => {\n        dispatch({\n          type: 'SET_LOADING',\n          payload: {\n            loading: false,\n            message: 'An error occurred'\n          }\n        });\n      }, 4000);\n    }\n  });\n};\nexport const logoutUser = () => {\n  return {\n    type: 'START_LOGOUT_USER'\n  };\n};\nexport const startLogout = () => dispatch => {\n  dispatch({\n    type: 'SET_LOADING',\n    payload: {\n      loading: false,\n      message: undefined\n    }\n  });\n  sessionStorage.clear('user');\n  sessionStorage.clear('token');\n  sessionStorage.clear('balance');\n  history.push('/');\n  dispatch(logoutUser());\n};","map":{"version":3,"names":["axios","LOGIN_API","setAuthToken","isEmpty","history","setWalletBalance","loginUser","user","isAuthenticated","walletBalance","commissionBalance","transactionSettings","virtualAccountNumber","virtualAccountBank","type","payload","startLoginUser","dispatch","post","then","res","_res$data","_res$data2","_res$data3","_res$data4","_res$data5","_res$data6","_res$data7","_res$data8","_res$data9","data","token","wallet","current_bal","commission","current_commission","settings","agentClassification","class","agent","virtual_account_number","virtual_account_bank","proprietor","hasSetPin","has_set_pin","id","username","phone","email","is_default","first_name","firstName","last_name","lastName","user_id","userId","business_name","businessName","wallet_no","walletNo","uuid","gender","business_address","date_of_birth","business_phone","account_name","account_number","bank_id","state_id","local_government_id","business_type","bvn","agent_code","authDetails","sessionStorage","setItem","JSON","stringify","catch","err","response","status","loading","message","setTimeout","logoutUser","startLogout","undefined","clear","push"],"sources":["C:/Users/USER/Documents/flexiMoney-web-app/src/actions/auth.js"],"sourcesContent":["import axios from 'axios';\r\n\r\nimport { LOGIN_API } from '../utils/constants';\r\nimport setAuthToken from '../utils/setAuthToken';\r\n// import setAxiosDefaults from '../utils/setAxiosDefaults';\r\nimport isEmpty from '../validation/isEmpty';\r\nimport history from '../utils/history';\r\nimport { setWalletBalance } from './wallet';\r\n\r\nconst loginUser = ({\r\n    user,\r\n    isAuthenticated,\r\n    walletBalance,\r\n    commissionBalance,\r\n    transactionSettings,\r\n    virtualAccountNumber,\r\n    virtualAccountBank,\r\n}) => {\r\n    return {\r\n        type: 'START_LOGIN_USER',\r\n        payload: {\r\n            isAuthenticated,\r\n            user,\r\n            walletBalance,\r\n            commissionBalance,\r\n            transactionSettings,\r\n            virtualAccountNumber,\r\n            virtualAccountBank,\r\n        },\r\n    };\r\n};\r\n\r\nexport const startLoginUser = (payload) => (dispatch) => {\r\n    return axios\r\n        .post(LOGIN_API, payload)\r\n        .then((res) => {\r\n            const user = res?.data?.data.user;\r\n            const token = res?.data?.data.token;\r\n            const walletBalance = res?.data?.data.wallet.current_bal;\r\n            const commissionBalance = res?.data?.data.commission.current_commission;\r\n            const transactionSettings = res?.data?.data.settings;\r\n            const agentClassification = res?.data?.data.class;\r\n            const agent = res?.data?.data.agent;\r\n            const virtualAccountNumber = agent?.virtual_account_number;\r\n            const virtualAccountBank = agent?.virtual_account_bank;\r\n            \r\n\r\n            // Extract virtual_account_number and virtual_account_bank from the agent object\r\n            // const { virtual_account_number: virtualAccountNumber, virtual_account_bank: virtualAccountBank } = agent;\r\n\r\n            const proprietor = res?.data?.data.user.proprietor;\r\n            const hasSetPin = res?.data?.data.has_set_pin;\r\n           \r\n\r\n            const { id, username, phone, email, is_default } = user;\r\n            const {\r\n                first_name: firstName,\r\n                last_name: lastName,\r\n                user_id: userId,\r\n                business_name: businessName,\r\n                wallet_no: walletNo,\r\n                uuid,\r\n                gender,\r\n                business_address,\r\n                date_of_birth,\r\n                business_phone,\r\n                account_name,\r\n                account_number,\r\n                bank_id,\r\n                state_id,\r\n                local_government_id,\r\n                business_type,\r\n                bvn,\r\n                agent_code,\r\n            } = agent;\r\n\r\n            if (!isEmpty(token)) {\r\n                const authDetails = {\r\n                    isAuthenticated: true,\r\n                    user: {\r\n                        account_name,\r\n                        account_number,\r\n                        bank_id,\r\n                        state_id,\r\n                        local_government_id,\r\n                        business_type,\r\n                        agent_code,\r\n                        id,\r\n                        username,\r\n                        phone,\r\n                        email,\r\n                        type: proprietor ? 'sub' : 'main',\r\n                        uuid,\r\n                        is_default,\r\n                        business_address,\r\n                        business_phone,\r\n                        bvn,\r\n                        firstName,\r\n                        lastName,\r\n                        virtualAccountNumber: virtualAccountNumber,\r\n                        virtualAccountBank: virtualAccountBank,\r\n                        agentClassification,\r\n                        userId,\r\n                        date_of_birth,\r\n                        gender,\r\n                        businessName,\r\n                        walletNo,\r\n                        hasSetPin,\r\n                    },\r\n                    walletBalance,\r\n                    transactionSettings,\r\n                };\r\n\r\n                setAuthToken(token);\r\n                dispatch(loginUser(authDetails));\r\n                dispatch(setWalletBalance(walletBalance));\r\n                sessionStorage.setItem('user', JSON.stringify(authDetails));\r\n                sessionStorage.setItem('token', token);\r\n                sessionStorage.setItem('balance', walletBalance);\r\n            }\r\n        })\r\n        .catch((err) => {\r\n            if (err.response && err.response.status === 401) {\r\n                dispatch({\r\n                    type: 'SET_LOADING',\r\n                    payload: {\r\n                        loading: false,\r\n                        message: err.response.data.message,\r\n                    },\r\n                });\r\n            } else {\r\n                setTimeout(() => {\r\n                    dispatch({\r\n                        type: 'SET_LOADING',\r\n                        payload: {\r\n                            loading: false,\r\n                            message: 'An error occurred',\r\n                        },\r\n                    });\r\n                }, 4000);\r\n            }\r\n        });\r\n        \r\n};\r\n\r\n\r\nexport const logoutUser = () => {\r\n    return {\r\n        type: 'START_LOGOUT_USER',\r\n    };\r\n};\r\n\r\nexport const startLogout = () => (dispatch) => {\r\n    dispatch({\r\n        type: 'SET_LOADING',\r\n        payload: {\r\n            loading: false,\r\n            message: undefined,\r\n        },\r\n    });\r\n\r\n    sessionStorage.clear('user');\r\n    sessionStorage.clear('token');\r\n    sessionStorage.clear('balance');\r\n    history.push('/');\r\n    dispatch(logoutUser());\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\USER\\\\Documents\\\\flexiMoney-web-app\\\\src\\\\features\\\\services\\\\electricity\\\\index.js\";\nimport React, { useState, useEffect, useReducer } from 'react';\nimport { connect } from 'react-redux';\nimport axios from 'axios';\nimport { useToasts } from 'react-toast-notifications';\nimport { VEND_ENERGY } from '../../../utils/constants';\nimport { setCurrentPage } from '../../../actions/page';\nimport ElectricityPaymentForm from './ElectricityPaymentForm';\nimport ElectricityPaymentSummary from './ElectricityPaymentSummary';\nimport ElectricityPaymentCompleted from './ElectricityPaymentCompleted';\nimport FailedTransaction from '../../../components/common/FailedTransaction';\nimport ElecticityPaymentReducer, { initialFormState } from './payment-reducer';\n// import { pink } from '@material-ui/core/colors';\n\nexport const ElectricityPayment = ({\n  service,\n  hasSetPin\n}) => {\n  const TRANSACTION_COST = 0;\n  let renderedComponent;\n  const [componentToRender, setComponentToRender] = useState('form');\n  const [ElectricityPaymentFormState, dispatch] = useReducer(ElecticityPaymentReducer, initialFormState);\n  const [loading, setLoading] = useState(false);\n  const [successData, setSuccessData] = useState(null);\n  const [agentLocation, setAgentLocation] = useState(null);\n  const {\n    addToast\n  } = useToasts();\n  useEffect(() => {\n    if ('geolocation' in navigator) {\n      navigator.geolocation.getCurrentPosition(function (position) {\n        setAgentLocation({\n          latitude: position.coords.latitude,\n          longitude: position.coords.longitude\n        });\n      });\n    }\n  }, []);\n  const handleOnSubmit = () => {\n    const {\n      meterNo,\n      paymentPlan,\n      amount,\n      phone,\n      transaction_pin\n    } = ElectricityPaymentFormState;\n    setLoading(true);\n    const req = {\n      meter_number: meterNo,\n      disco: service,\n      type: paymentPlan,\n      amount: parseInt(amount),\n      phone: phone,\n      transaction_pin: transaction_pin\n    };\n    (async function vendEnergy() {\n      try {\n        const options = {\n          headers: {\n            lat: agentLocation === null || agentLocation === void 0 ? void 0 : agentLocation.latitude,\n            lng: agentLocation === null || agentLocation === void 0 ? void 0 : agentLocation.longitude\n          }\n        };\n        const res = await axios.post(VEND_ENERGY, req, options);\n        const message = res.data.data.message;\n        setLoading(false);\n        setSuccessData(res.data.data);\n        addToast(message, {\n          appearance: 'success',\n          autoDismiss: true\n        });\n        setComponentToRender('success');\n      } catch (err) {\n        if (err.response && err.response.status === 403) {\n          setLoading(false);\n          addToast(err.response.data.message, {\n            appearance: 'error',\n            autoDismiss: true\n          });\n          setComponentToRender('failed');\n        } else if (err.response && err.response.status === 400) {\n          setLoading(false);\n          addToast(err.response.data.message, {\n            appearance: 'error',\n            autoDismiss: true\n          });\n          setComponentToRender('failed');\n        } else {\n          setLoading(false);\n          setComponentToRender('failed');\n        }\n      }\n    })();\n  };\n  switch (componentToRender) {\n    case 'form':\n      renderedComponent = /*#__PURE__*/React.createElement(ElectricityPaymentForm, {\n        setComponentToRender: setComponentToRender,\n        setState: dispatch,\n        service: service,\n        ElectricityPaymentFormState: ElectricityPaymentFormState,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 17\n        }\n      });\n      break;\n    case 'summary':\n      renderedComponent = /*#__PURE__*/React.createElement(ElectricityPaymentSummary, {\n        ElectricityPaymentFormState: ElectricityPaymentFormState,\n        handleOnSubmit: handleOnSubmit,\n        setComponentToRender: setComponentToRender,\n        loading: loading,\n        service: service,\n        hasSetPin: hasSetPin,\n        dispatch: dispatch,\n        transactionCost: TRANSACTION_COST,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 17\n        }\n      });\n      break;\n    case 'success':\n      renderedComponent = /*#__PURE__*/React.createElement(ElectricityPaymentCompleted, {\n        successData: successData,\n        service: service,\n        ElectricityPaymentFormState: ElectricityPaymentFormState,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 121,\n          columnNumber: 17\n        }\n      });\n      break;\n    case 'failed':\n      renderedComponent = /*#__PURE__*/React.createElement(FailedTransaction, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 33\n        }\n      });\n      break;\n    default:\n      renderedComponent = null;\n  }\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 12\n    }\n  }, renderedComponent);\n};\nconst mapStateToProps = state => {\n  return {\n    service: state.modal.service,\n    hasSetPin: state.auth.user.hasSetPin\n  };\n};\nconst mapDispatchToProps = dispatch => {\n  return {\n    changeCurrentPage: payload => dispatch(setCurrentPage(payload))\n  };\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(ElectricityPayment);","map":{"version":3,"names":["React","useState","useEffect","useReducer","connect","axios","useToasts","VEND_ENERGY","setCurrentPage","ElectricityPaymentForm","ElectricityPaymentSummary","ElectricityPaymentCompleted","FailedTransaction","ElecticityPaymentReducer","initialFormState","ElectricityPayment","service","hasSetPin","TRANSACTION_COST","renderedComponent","componentToRender","setComponentToRender","ElectricityPaymentFormState","dispatch","loading","setLoading","successData","setSuccessData","agentLocation","setAgentLocation","addToast","navigator","geolocation","getCurrentPosition","position","latitude","coords","longitude","handleOnSubmit","meterNo","paymentPlan","amount","phone","transaction_pin","req","meter_number","disco","type","parseInt","vendEnergy","options","headers","lat","lng","res","post","message","data","appearance","autoDismiss","err","response","status","createElement","setState","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","transactionCost","mapStateToProps","state","modal","auth","user","mapDispatchToProps","changeCurrentPage","payload"],"sources":["C:/Users/USER/Documents/flexiMoney-web-app/src/features/services/electricity/index.js"],"sourcesContent":["import React, { useState, useEffect, useReducer } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport axios from 'axios';\r\nimport { useToasts } from 'react-toast-notifications';\r\nimport { VEND_ENERGY } from '../../../utils/constants';\r\nimport { setCurrentPage } from '../../../actions/page';\r\nimport ElectricityPaymentForm from './ElectricityPaymentForm';\r\nimport ElectricityPaymentSummary from './ElectricityPaymentSummary';\r\nimport ElectricityPaymentCompleted from './ElectricityPaymentCompleted';\r\nimport FailedTransaction from '../../../components/common/FailedTransaction';\r\nimport ElecticityPaymentReducer, { initialFormState } from './payment-reducer';\r\n// import { pink } from '@material-ui/core/colors';\r\n\r\nexport const ElectricityPayment = ({ service, hasSetPin }) => {\r\n    const TRANSACTION_COST = 0;\r\n    let renderedComponent;\r\n    const [componentToRender, setComponentToRender] = useState('form');\r\n    const [ElectricityPaymentFormState, dispatch] = useReducer(\r\n        ElecticityPaymentReducer,\r\n        initialFormState\r\n    );\r\n    const [loading, setLoading] = useState(false);\r\n    const [successData, setSuccessData] = useState(null);\r\n    const [agentLocation, setAgentLocation] = useState(null);\r\n    const { addToast } = useToasts();\r\n\r\n    useEffect(() => {\r\n        if ('geolocation' in navigator) {\r\n            navigator.geolocation.getCurrentPosition(function (position) {\r\n                setAgentLocation({\r\n                    latitude: position.coords.latitude,\r\n                    longitude: position.coords.longitude,\r\n                });\r\n            });\r\n        }\r\n    }, []);\r\n\r\n    const handleOnSubmit = () => {\r\n        const { meterNo, paymentPlan, amount, phone, transaction_pin } =\r\n            ElectricityPaymentFormState;\r\n        setLoading(true);\r\n\r\n        const req = {\r\n            meter_number: meterNo,\r\n            disco: service,\r\n            type: paymentPlan,\r\n            amount: parseInt(amount),\r\n            phone: phone,\r\n            transaction_pin:transaction_pin,\r\n        };\r\n\r\n        (async function vendEnergy() {\r\n            try {\r\n                const options = {\r\n                    headers: {\r\n                        lat: agentLocation?.latitude,\r\n                        lng: agentLocation?.longitude,\r\n                    },\r\n                };\r\n\r\n                const res = await axios.post(VEND_ENERGY, req, options);\r\n                const message = res.data.data.message;\r\n\r\n                setLoading(false);\r\n                setSuccessData(res.data.data);\r\n                addToast(message, {\r\n                    appearance: 'success',\r\n                    autoDismiss: true,\r\n                });\r\n                setComponentToRender('success');\r\n            } catch (err) {\r\n                if (err.response && err.response.status === 403) {\r\n                    setLoading(false);\r\n                    addToast(err.response.data.message, {\r\n                        appearance: 'error',\r\n                        autoDismiss: true,\r\n                    });\r\n                    setComponentToRender('failed');\r\n                } else if (err.response && err.response.status === 400) {\r\n                    setLoading(false);\r\n                    addToast(err.response.data.message, {\r\n                        appearance: 'error',\r\n                        autoDismiss: true,\r\n                    });\r\n                    setComponentToRender('failed');\r\n                } else {\r\n                    setLoading(false);\r\n                    setComponentToRender('failed');\r\n                }\r\n            }\r\n        })();\r\n    };\r\n\r\n    switch (componentToRender) {\r\n        case 'form':\r\n            renderedComponent = (\r\n                <ElectricityPaymentForm\r\n                    setComponentToRender={setComponentToRender}\r\n                    setState={dispatch}\r\n                    service={service}\r\n                    ElectricityPaymentFormState={ElectricityPaymentFormState}\r\n                />\r\n            );\r\n            break;\r\n        case 'summary':\r\n            renderedComponent = (\r\n                <ElectricityPaymentSummary\r\n                    ElectricityPaymentFormState={ElectricityPaymentFormState}\r\n                    handleOnSubmit={handleOnSubmit}\r\n                    setComponentToRender={setComponentToRender}\r\n                    loading={loading}\r\n                    service={service}\r\n                    hasSetPin={hasSetPin}\r\n                    dispatch={dispatch}\r\n                    transactionCost={TRANSACTION_COST}\r\n                />\r\n            );\r\n            break;\r\n        case 'success':\r\n            renderedComponent = (\r\n                <ElectricityPaymentCompleted\r\n                    successData={successData}\r\n                    service={service}\r\n                    ElectricityPaymentFormState={ElectricityPaymentFormState}\r\n                />\r\n            );\r\n            break;\r\n        case 'failed':\r\n            renderedComponent = <FailedTransaction />;\r\n            break;\r\n        default:\r\n            renderedComponent = null;\r\n    }\r\n\r\n    return <div>{renderedComponent}</div>;\r\n};\r\n\r\nconst mapStateToProps = (state) => {\r\n    return {\r\n        service: state.modal.service,\r\n        hasSetPin: state.auth.user.hasSetPin,\r\n    };\r\n};\r\n\r\nconst mapDispatchToProps = (dispatch) => {\r\n    return {\r\n        changeCurrentPage: (payload) => dispatch(setCurrentPage(payload)),\r\n    };\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(ElectricityPayment);\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}